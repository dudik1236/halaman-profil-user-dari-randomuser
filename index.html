<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RandomUser • Profile (Online + Offline) — Stylish</title>
  <meta name="description" content="Halaman profil dinamis dari RandomUser API dengan desain atraktif, animasi halus, fallback offline, timeout+retry, dan self-test. Cocok untuk GitHub Pages/Netlify/Vercel." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] },
          colors: {
            brand: {
              50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81'
            },
          },
        }
      },
      darkMode: 'class'
    }
  </script>
  <style>
    :root { --blob1:#7c5cff; --blob2:#24d6d9; }
    .hero-bg { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
    .blob { position: absolute; filter: blur(40px); opacity:.35; transform: translate(-50%, -50%); border-radius: 50%; }
    .blob.a { width: 500px; height: 500px; background: var(--blob1); top: -10%; left: 10%; animation: floatA 14s ease-in-out infinite; }
    .blob.b { width: 650px; height: 650px; background: var(--blob2); top: 15%; left: 85%; animation: floatB 18s ease-in-out infinite; }
    .blob.c { width: 520px; height: 520px; background: #ff7ab6; top: 95%; left: 10%; animation: floatC 20s ease-in-out infinite; }
    @keyframes floatA { 0%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-48%,-47%) scale(1.15)} 100%{transform:translate(-50%,-50%) scale(1)} }
    @keyframes floatB { 0%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-52%,-53%) scale(1.08)} 100%{transform:translate(-50%,-50%) scale(1)} }
    @keyframes floatC { 0%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-47%,-52%) scale(1.12)} 100%{transform:translate(-50%,-50%) scale(1)} }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.65); }
    .dark .glass { background: rgba(17,24,39,.55); }
    .tilt { transform-style: preserve-3d; transition: transform .15s ease; }
    .tilt:hover { transform: perspective(900px) rotateX(2deg) rotateY(-2deg) translateY(-2px); }
    .kbd{ border:1px solid #cbd5e1; border-bottom-width:2px; border-radius:.5rem; padding:.15rem .4rem; font-size:.75rem; background:#fff; }
    .dark .kbd{ background:#0f172a; border-color:#334155; }
    .shimmer{ background: linear-gradient(100deg, rgba(148,163,184,.2) 20%, rgba(148,163,184,.4) 40%, rgba(148,163,184,.2) 60%); background-size: 200% 100%; animation: shimmer 1.1s infinite; }
    @keyframes shimmer{0%{background-position: 200% 0} 100%{background-position: -200% 0}}
    /* Confetti canvas sits on top during success events */
    #confetti { pointer-events:none; position: fixed; inset: 0; z-index: 40; display:none; }

    /* --- Minor polish for attraction --- */
    button:hover { box-shadow: 0 10px 25px rgba(2,6,23,.08); transform: translateY(-1px); transition: all .15s ease; }
    #avatar { transition: transform .25s ease; }
    #avatar:hover { transform: scale(1.02) translateY(-1px); }
  </style>
</head>
<body class="min-h-screen font-sans bg-gradient-to-br from-slate-50 via-white to-indigo-50 text-slate-800 dark:from-slate-900 dark:via-slate-950 dark:to-indigo-950 dark:text-slate-100 transition-colors">
  <!-- animated background blobs -->
  <div class="hero-bg">
    <div class="blob a"></div>
    <div class="blob b"></div>
    <div class="blob c"></div>
  </div>
  <canvas id="confetti"></canvas>

  <header class="sticky top-0 z-30 border-b border-slate-200/60 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/60 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-brand-500 to-cyan-400 shadow ring-2 ring-white/70 dark:ring-slate-900/40"></div>
        <h1 class="text-base sm:text-lg font-semibold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-brand-600 to-cyan-500">RandomUser Stylish Profile</h1>
      </div>
      <nav class="flex items-center gap-2">
        <button id="btnTheme" class="glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm">🌗 Tema</button>
        <button id="btnRefresh" class="glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm">🔄 Online</button>
        <button id="btnOffline" class="glass border border-amber-300/70 dark:border-amber-600/60 bg-amber-100/60 dark:bg-amber-400/10 rounded-xl px-3 py-2 text-sm text-amber-800 dark:text-amber-300">📴 Offline</button>
        <button id="btnShare" class="glass border border-blue-300/70 dark:border-blue-600/60 bg-blue-100/60 dark:bg-blue-500/10 rounded-xl px-3 py-2 text-sm text-blue-900 dark:text-blue-300">🔗 Share</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
    <div id="banner" class="hidden mb-4 glass border border-slate-300/60 dark:border-slate-700/60 rounded-2xl p-3 text-sm"></div>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Profile Card -->
      <div class="lg:col-span-1">
        <div class="tilt rounded-3xl glass border border-slate-300/60 dark:border-slate-700/60 shadow-xl overflow-hidden">
          <div class="relative h-44 sm:h-40 bg-gradient-to-br from-brand-500 to-cyan-400">
            <img id="coverFlag" alt="country flag" class="absolute right-3 bottom-3 h-7 w-10 object-cover rounded-md shadow ring-1 ring-white/80 hidden" />
          </div>
          <div class="px-6 pb-6 relative z-10">
            <div class="flex items-end gap-4">
              <div class="shrink-0 -mt-12">
                <div class="h-24 w-24 rounded-2xl overflow-hidden ring-4 ring-white/90 dark:ring-slate-900/60 bg-slate-100 dark:bg-slate-800 relative">
                  <img id="avatar" alt="avatar" class="h-full w-full object-cover hidden"/>
                  <div id="avatarSkel" class="absolute inset-0 shimmer"></div>
                </div>
              </div>
              <div class="flex-1 pb-2 min-w-0">
                <p id="name" class="text-2xl sm:text-3xl font-extrabold leading-snug tracking-tight break-words [hyphens:auto]">&nbsp;</p>
                <p id="username" class="text-slate-500 dark:text-slate-400 text-sm truncate">&nbsp;</p>
              </div>
            </div>

            <dl class="mt-6 space-y-3 text-sm">
              <div class="flex items-center gap-3"><span class="shrink-0">📧</span><dd id="email" class="truncate">&nbsp;</dd></div>
              <div class="flex items-center gap-3"><span class="shrink-0">📞</span><dd id="phone" class="truncate">&nbsp;</dd></div>
              <div class="flex items-center gap-3"><span class="shrink-0">🎂</span><dd id="dob" class="truncate">&nbsp;</dd></div>
              <div class="flex items-center gap-3"><span class="shrink-0">🕒</span><dd id="timezone" class="truncate">&nbsp;</dd></div>
            </dl>

            <div class="mt-6 grid grid-cols-2 gap-3">
              <a id="btnMail" target="_blank" rel="noreferrer" class="text-center glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm hover:shadow-lg">Email</a>
              <a id="btnMap" target="_blank" rel="noreferrer" class="text-center glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm hover:shadow-lg">Map</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Details & JSON -->
      <div class="lg:col-span-2">
        <div class="rounded-3xl glass border border-slate-300/60 dark:border-slate-700/60 shadow-xl p-6">
          <h2 class="text-lg font-semibold mb-1">Tentang</h2>
          <p id="about" class="text-slate-700 dark:text-slate-300 leading-relaxed">Loading…</p>

          <div class="mt-8 grid sm:grid-cols-2 gap-6">
            <div>
              <h3 class="font-semibold mb-2">Alamat</h3>
              <p id="address" class="text-slate-700 dark:text-slate-300">&nbsp;</p>
            </div>
            <div>
              <h3 class="font-semibold mb-2">IDs</h3>
              <ul class="text-slate-700 dark:text-slate-300 space-y-1 text-sm" id="ids">
                <li><span class="font-medium">UUID:</span> <span id="uuid">&nbsp;</span></li>
                <li><span class="font-medium">Registered:</span> <span id="registered">&nbsp;</span></li>
                <li><span class="font-medium">Nationality:</span> <span id="nat">&nbsp;</span></li>
              </ul>
            </div>
          </div>

          <div class="mt-8">
            <h3 class="font-semibold mb-2">Raw JSON</h3>
            <pre id="raw" class="text-xs bg-slate-900/90 text-slate-100 p-4 rounded-xl overflow-auto max-h-72"></pre>
            <div class="mt-3 flex flex-wrap gap-2">
              <button id="btnCopy" class="glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm">Copy JSON</button>
              <button id="btnDownload" class="glass border border-slate-200/70 dark:border-slate-700/60 rounded-xl px-3 py-2 text-sm">Download JSON</button>
              <button id="btnSelfTest" class="glass border border-emerald-400/70 dark:border-emerald-600/60 bg-emerald-100/60 dark:bg-emerald-500/10 text-emerald-900 dark:text-emerald-300 rounded-xl px-3 py-2 text-sm">Run Self‑Test</button>
            </div>
            <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">Shortcut: <span class="kbd">R</span> online, <span class="kbd">O</span> offline, <span class="kbd">T</span> tema.</p>
          </div>
        </div>
      </div>
    </section>

    <footer class="mt-10 text-center text-xs text-slate-600 dark:text-slate-400">
      GitHub Pages / Netlify / Vercel. Data dari <a class="underline" href="https://randomuser.me/" target="_blank" rel="noreferrer">randomuser.me</a>.
    </footer>
  </main>

  <template id="aboutTmpl">
    <span>Hai, saya <strong>{{first}} {{last}}</strong> ({{gender}}) dan tinggal di {{city}}, {{country}}. Zona waktu: <span class="font-medium">{{tz}}</span>. Usia <span class="font-medium">{{age}}</span> tahun, username <span class="font-mono">@{{user}}</span>.</span>
  </template>

  <script>
    // ---------- Utilities ----------
    const $ = (id) => document.getElementById(id);
    const formatDate = (iso) => new Date(iso).toLocaleString(undefined, { dateStyle: 'medium' });
    const flagUrl = (code) => `https://flagcdn.com/w80/${String(code||'').toLowerCase()}.png`;

    function setText(id, text) { $(id).textContent = text ?? ''; }
    function toggleLoading(isLoading) { $('avatar').classList.toggle('hidden', isLoading); $('avatarSkel').classList.toggle('hidden', !isLoading); }
    function banner(msg, type = 'info') {
      const b = $('banner');
      b.className = `mb-4 glass border rounded-2xl p-3 text-sm ${type==='error'?'border-red-300 bg-red-100/70 text-red-900 dark:bg-red-400/10 dark:text-red-300 dark:border-red-700/60': type==='warn'?'border-amber-300 bg-amber-100/70 text-amber-900 dark:bg-amber-400/10 dark:text-amber-300 dark:border-amber-700/60':'border-sky-300 bg-sky-100/70 text-sky-900 dark:bg-sky-400/10 dark:text-sky-300 dark:border-sky-700/60'}`;
      b.textContent = msg; b.classList.remove('hidden');
    }

    // ---------- Confetti (simple) ----------
    function burstConfetti() {
      const canvas = $('confetti'); const ctx = canvas.getContext('2d');
      const W = canvas.width = innerWidth; const H = canvas.height = innerHeight;
      const N = 140; const parts = Array.from({length:N}, () => ({
        x: Math.random()*W, y: -20-Math.random()*H*0.2, r: 4+Math.random()*3, s: 1+Math.random()*2,
        c: `hsl(${Math.random()*360},90%,60%)`, a: 1
      }));
      canvas.style.display = 'block';
      let t=0; const anim = () => {
        t++; ctx.clearRect(0,0,W,H);
        parts.forEach(p=>{ p.y += p.s*2; p.x += Math.sin((p.y+p.r)*.02)*1.2; p.a -= .007; ctx.globalAlpha = Math.max(p.a,0); ctx.fillStyle = p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
        if (t<220) requestAnimationFrame(anim); else canvas.style.display = 'none';
      };
      anim();
    }

    // ---------- Offline mocks (tests & restricted envs) ----------
    const MOCK_USERS = [
      // Test Case 1
      { results: [{
        gender: "male",
        name: { title: "Mr", first: "Adi", last: "Santoso" },
        location: { street: { number: 12, name: "Jalan Merpati" }, city: "Bogor", state: "Jawa Barat", country: "Indonesia", postcode: 16111, timezone: { offset: "+07:00", description: "Jakarta" } },
        email: "adi.santoso@example.com",
        login: { uuid: "11111111-2222-3333-4444-555555555555", username: "adisantoso" },
        dob: { date: "1999-02-15T08:20:00.000Z", age: 26 },
        registered: { date: "2022-06-01T10:00:00.000Z" },
        phone: "+62-21-555-0000", cell: "+62-815-0000-0000",
        picture: { large: "https://randomuser.me/api/portraits/men/75.jpg" },
        nat: "ID"
      }]},
      // Test Case 2 (edge fields)
      { results: [{
        gender: "female",
        name: { title: "Ms", first: "Jane", last: "Doe" },
        location: { street: { number: 100, name: "Main St" }, city: "Seattle", state: "Washington", country: "United States", postcode: "98101", timezone: { offset: "-07:00", description: "Pacific Time" } },
        email: "jane.doe@example.com",
        login: { uuid: "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee", username: "janed" },
        dob: { date: "1990-07-10T00:00:00.000Z", age: 35 },
        registered: { date: "2015-03-05T00:00:00.000Z" },
        phone: "+1-206-555-1234", cell: "",
        picture: { large: "https://randomuser.me/api/portraits/women/47.jpg" },
        nat: "US"
      }]}
    ];

    // ---------- Robust fetch with timeout & retries ----------
    function normalizeFetchError(err, timeout){
      if (err && (err.name === 'AbortError')){
        const e = new Error(`Request timed out after ${timeout} ms`);
        e.code = 'ETIMEDOUT';
        return e;
      }
      return err || new Error('Unknown fetch error');
    }

    async function fetchWithTimeout(url, { timeout = 6000, retries = 2 } = {}) {
      let lastError;
      for (let attempt = 0; attempt <= retries; attempt++) {
        const ctl = new AbortController();
        const timer = setTimeout(() => ctl.abort(), timeout);
        try {
          const res = await fetch(url, { signal: ctl.signal, cache: 'no-store' });
          clearTimeout(timer);
          if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
          return await res.json();
        } catch (err) {
          clearTimeout(timer);
          lastError = normalizeFetchError(err, timeout);
          // small backoff before retry
          await new Promise(r => setTimeout(r, 300 * (attempt + 1)));
        }
      }
      throw lastError || new Error('Failed to fetch');
    }

    async function getUserOnline() {
      const url = 'https://randomuser.me/api/?nat=us,gb,fr,au,ca,id&inc=gender,name,location,email,login,phone,cell,dob,registered,picture,nat&noinfo&results=1';
      const data = await fetchWithTimeout(url, { timeout: 7000, retries: 2 });
      const u = data.results?.[0]; if (!u) throw new Error('Empty results');
      return { raw: data, u };
    }
    function getUserOffline(index = 0) { const data = MOCK_USERS[index % MOCK_USERS.length]; return { raw: data, u: data.results[0] }; }

    function render({ raw, u }, { celebrate=false } = {}) {
      // dynamic palette based on nationality
      document.documentElement.style.setProperty('--blob1', u.nat ? '#4f46e5' : '#7c5cff');
      document.documentElement.style.setProperty('--blob2', u.nat ? '#06b6d4' : '#24d6d9');

      $('avatar').src = u.picture?.large || u.picture?.medium || '';
      $('avatar').alt = `${u?.name?.first ?? ''} ${u?.name?.last ?? ''}`.trim() || 'avatar';
      $('avatar').classList.remove('hidden'); $('avatarSkel').classList.add('hidden');

      if (u.nat) {
        $('coverFlag').src = flagUrl(u.nat);
        $('coverFlag').alt = u.location?.country ? `Flag of ${u.location.country}` : 'country flag';
        $('coverFlag').classList.remove('hidden');
      } else { $('coverFlag').classList.add('hidden'); }

      setText('name', `${u.name?.title ?? ''} ${u.name?.first ?? ''} ${u.name?.last ?? ''}`.trim());
      setText('username', `@${u.login?.username ?? 'unknown'}`);

      const dob = `${u.dob?.date ? formatDate(u.dob.date) : '-'} • ${u.dob?.age ?? '?'} th`;
      setText('email', u.email ?? '-');
      setText('phone', u.phone ?? '-');
      setText('dob', dob);
      setText('timezone', `${u.location?.timezone?.offset ?? ''} ${u.location?.timezone?.description ?? ''}`.trim());

      $('btnMail').href = `mailto:${encodeURIComponent(u.email ?? '')}?subject=${encodeURIComponent('Hello ' + (u.name?.first ?? ''))}`;
      const q = encodeURIComponent(`${u.location?.street?.number ?? ''} ${u.location?.street?.name ?? ''}, ${u.location?.city ?? ''}, ${u.location?.state ?? ''}, ${u.location?.country ?? ''}, ${u.location?.postcode ?? ''}`);
      $('btnMap').href = `https://www.google.com/maps/search/?api=1&query=${q}`;

      const tmpl = $('aboutTmpl').innerHTML
        .replace('{{first}}', u.name?.first ?? '')
        .replace('{{last}}', u.name?.last ?? '')
        .replace('{{gender}}', u.gender ?? '')
        .replace('{{city}}', u.location?.city ?? '')
        .replace('{{country}}', u.location?.country ?? '')
        .replace('{{tz}}', `${u.location?.timezone?.offset ?? ''} ${u.location?.timezone?.description ?? ''}`.trim())
        .replace('{{age}}', u.dob?.age ?? '')
        .replace('{{user}}', u.login?.username ?? '');
      $('about').innerHTML = tmpl;

      setText('address', `${u.location?.street?.number ?? ''} ${u.location?.street?.name ?? ''}, ${u.location?.city ?? ''}, ${u.location?.state ?? ''}, ${u.location?.country ?? ''} ${u.location?.postcode ?? ''}`.replace(/\s+,/g, ',').replace(/\s+/g,' ').trim());
      setText('uuid', u.login?.uuid ?? '-');
      setText('registered', u.registered?.date ? formatDate(u.registered.date) : '-');
      setText('nat', u.nat ?? '-');

      // ensure repaint for long JSON strings
      $('raw').textContent = '';
      $('raw').textContent = JSON.stringify(raw, null, 2);

      if (celebrate) burstConfetti();
    }

    async function loadUser({ mode = 'auto', offlineIndex = 0 } = {}) {
      toggleLoading(true); $('banner').classList.add('hidden');
      try {
        if (mode === 'offline') {
          const data = getUserOffline(offlineIndex); render(data); banner('OFFLINE demo user ditampilkan (tidak butuh internet).', 'warn');
        } else {
          const urlParams = new URLSearchParams(location.search);
          const forceOffline = urlParams.has('offline') || !navigator.onLine || location.protocol === 'file:';
          if (forceOffline) { const data = getUserOffline(offlineIndex); render(data); banner('Mode offline aktif. Tambahkan parameter ?online=1 setelah deploy untuk uji live.', 'warn'); }
          else { const data = await getUserOnline(); render(data, { celebrate: true }); banner('Data live berhasil dimuat dari RandomUser API.', 'info'); }
        }
      } catch (err) {
        console.error(err);
        const data = getUserOffline(offlineIndex);
        render(data);
        const msg = (err && (err.code === 'ETIMEDOUT' || err.name === 'AbortError'))
          ? 'Permintaan ke API timeout. Menampilkan demo OFFLINE.'
          : 'Gagal mengambil data online — beralih ke OFFLINE demo.';
        banner(`${msg} Error: ${err?.message||err}`, (err && (err.code==='ETIMEDOUT')) ? 'warn' : 'error');
      } finally { toggleLoading(false); }
    }

    // Copy/Download/Share
    $('btnCopy').addEventListener('click', () => {
      const text = $('raw').textContent;
      navigator.clipboard?.writeText(text).then(()=>alert('JSON disalin')).catch(()=>alert('Gagal menyalin'));
    });

    $('btnDownload').addEventListener('click', () => {
      const jsonText = $('raw').textContent;
      const blob = new Blob([jsonText], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'randomuser.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    $('btnShare').addEventListener('click', async () => {
      const url = location.href;
      if (navigator.share) {
        try { await navigator.share({ title:'RandomUser Profile', url }); } catch(_){}
      } else {
        await navigator.clipboard?.writeText(url);
        alert('URL halaman disalin');
      }
    });

    $('btnRefresh').addEventListener('click', () => loadUser({ mode: 'online' }));
    $('btnOffline').addEventListener('click', () => loadUser({ mode: 'offline', offlineIndex: Date.now() }));

    // Theme toggle & persist
    const THEME_KEY = 'ru_theme';
    function applyTheme(theme){ document.documentElement.classList.toggle('dark', theme==='dark'); localStorage.setItem(THEME_KEY, theme); }
    $('btnTheme').addEventListener('click', () => { const cur = localStorage.getItem(THEME_KEY) || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'); applyTheme(cur==='dark'?'light':'dark'); });
    applyTheme(localStorage.getItem(THEME_KEY) || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));

    // Shortcuts
    window.addEventListener('keydown', (e) => { const k=e.key.toLowerCase(); if(k==='r'){e.preventDefault(); loadUser({ mode:'online' });} if(k==='o'){e.preventDefault(); loadUser({ mode:'offline', offlineIndex: Date.now() });} if(k==='t'){e.preventDefault(); $('btnTheme').click(); } });

    // Self Tests (no network)
    function selfTest() {
      const logs = []; const t=(name,fn)=>{ try{ fn(); logs.push('✅ '+name);}catch(e){ logs.push('❌ '+name+' — '+e.message);} };

      // Keep existing cases
      const d1 = getUserOffline(0); render(d1);
      t('Nama terisi (TC1)', () => { if (!$('name').textContent.trim()) throw new Error('kosong'); });
      t('UUID ada (TC1)', () => { if (!$('uuid').textContent.trim()) throw new Error('uuid kosong'); });

      const d2 = getUserOffline(1); render(d2);
      t('Phone tampil meski cell kosong (TC2)', () => { if (!$('phone').textContent.includes('+1-206')) throw new Error('phone tidak tampil'); });
      t('Nationality sesuai (TC2)', () => { if ($('nat').textContent.trim() !== 'US') throw new Error('nat mismatch'); });
      t('Raw JSON tersedia', () => { if (!$('raw').textContent.includes('results')) throw new Error('raw kosong'); });

      // --- Additional tests ---
      t('About template ter-render', () => { if (!$('about').textContent.includes('username')) throw new Error('about tidak terisi'); });
      t('Alamat mengandung kota', () => { if (!$('address').textContent) throw new Error('alamat kosong'); });
      t('Username berawalan @', () => { if (!$('username').textContent.trim().startsWith('@')) throw new Error('username tanpa @'); });
      t('Download JSON tidak error (simulasi)', () => {
        const txt = $('raw').textContent || '{"ok":true}';
        const b = new Blob([txt], { type: 'application/json' });
        if (!(b instanceof Blob)) throw new Error('blob gagal');
      });
      t('Phone hanya menampilkan phone (tanpa pemisah •)', () => {
        if ($('phone').textContent.includes('•')) throw new Error('phone mengandung cell/•');
      });
      // new: ensure AbortError normalized
      t('AbortError dinormalisasi jadi ETIMEDOUT', () => {
        const err = normalizeFetchError({ name: 'AbortError' }, 1234);
        if (err.code !== 'ETIMEDOUT') throw new Error('normalisasi gagal');
      });

      alert('Self‑Test results:\n'+logs.join('\n'));
    }
    $('btnSelfTest').addEventListener('click', selfTest);

    // Init
    loadUser({ mode: 'auto' });
  </script>
</body>
</html>


